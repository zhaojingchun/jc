<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="GB2312">
        <title>Title</title>
        <script src="./jquery-2.1.3.min.js"></script>
    </head>

    <body>
	  
        源文件: <input type="file" name="file" onchange="addSourceData(this,'#dataSource')" /> <br>
		第X列: <input id="orderColume" type="text" value="113"  style="width:200px"/> 包含：<input id="haveStr" type="text" value="跟单"  style="width:200px"/>的留下，下面的列 <br>
		<input id="haveColume" type="text" value="1,2,5,8,31,54,55,112,113,141"  style="width:800px"/>(多列用英文逗号分隔) <br>
		
        <button id ="execute" onclick="appendExecute();" >执行</button>

        <textarea  id="dataSource"   style="height: 200px;width:10000px;"></textarea>
        <textarea id="resultData"  style="height: 200px;width:10000px;"></textarea>

        <div id="masking" style="width:100%;height: 100%;position:fixed;top:0px;left: 0px;background-color: rgba(0,255,255,0.5);" hidden="hidden">
            <img style="display: block; height: 37px;margin: 25% auto"  src="./jbox-content-loading.gif" >
        </div>

    </body>

    <script type="text/javascript">
	    
        //源数据id
        sourceIds = [];
        /**
         * 添加原始数据
         */
	   function addSourceData(source,id) {
            var file = source.files[0];
            if(window.FileReader) {
                var fr = new FileReader();
                fr.onloadend = function(e) {
                  $(id).empty().val(e.target.result)
                };
                fr.readAsText(file,"GB2312")
            }
        }
        
        /**
         * 执行追加方法显示蒙版
         */
        function appendExecute() {
            $("#masking").show();
            setTimeout(executeData,3000);
        }
        /**
         * 执行追加
         */
        function executeData(){
            //最佳数据
            appendData();
            //下载
            downLoadExecute();
            $("#masking").hide();
        }
        /**
         * 追加数据
         */
        function appendData(){
			var haveStr = $("#haveStr").val()
			var orderColume = $("#orderColume").val()
			var haveData =  $("#haveColume").val().split(",");
            var resultData = $("#resultData");
            resultData.empty();
            var dataSource = $("#dataSource").val();
            var trArr = getTrs(dataSource)
			var appendData = "";
            for(i=0;i<trArr.length;i++){
                var columeArr = trArr[i].split(",");
				if(columeArr[orderColume-1]&&columeArr[orderColume-1].indexOf(haveStr)>=0){
					for(j=0;j<haveData.length;j++){
					   appendData=appendData+(typeof(columeArr[haveData[j]-1]) == "undefined"?"":columeArr[haveData[j]-1])+",";
					}
					resultData.append("\r\n").append(appendData.replaceAll("\"","").replaceAll("“",""));
					appendData="";
				}
            }
        }

String.prototype.replaceAll = function(s1,s2){ 
return this.replace(new RegExp(s1,"gm"),s2); 
}
        /**
         * 获取行数据
         */
        function getTrs(yuandata){
            var trArr = yuandata.split(/\r?\n/);
            return trArr;
        }

        

        /**
         * 下载
         */
        function downLoadExecute () {
            var filename = "quickDelete.txt";
            var content =$("#resultData").val();
            download(filename, content);
        };
        /**
         * 下载执行
         */
        function download(filename, content) {
            var blob = new Blob([content], {type: 'text/html,charset=GB2312' });
            var url = window.URL.createObjectURL(blob);
            var a = document.createElement('a');

            a.style = "display: none";
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();

            setTimeout(function () {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 5);
        }
		



    </script>
</html>